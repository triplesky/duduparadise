<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å…ƒç´ å‘¨æœŸè¡¨ - å˜Ÿå˜Ÿä¹å›­</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'ZCOOL KuaiLe', Helvetica, sans-serif;
            background: #000510;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* æ˜Ÿç©ºèƒŒæ™¯ */
        #starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: radial-gradient(ellipse at bottom, #1B2838 0%, #000510 100%);
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .stars-1 {
            background-image:
                radial-gradient(2px 2px at 20px 30px, #eee, transparent),
                radial-gradient(2px 2px at 40px 70px, #fff, transparent),
                radial-gradient(1px 1px at 90px 40px, #ddd, transparent),
                radial-gradient(2px 2px at 160px 120px, #fff, transparent),
                radial-gradient(1px 1px at 230px 80px, #eee, transparent),
                radial-gradient(2px 2px at 300px 150px, #fff, transparent),
                radial-gradient(1px 1px at 380px 60px, #ddd, transparent),
                radial-gradient(2px 2px at 450px 180px, #eee, transparent);
            background-repeat: repeat;
            background-size: 500px 300px;
            animation: twinkle 4s ease-in-out infinite;
        }

        .stars-2 {
            background-image:
                radial-gradient(1px 1px at 50px 150px, #fff, transparent),
                radial-gradient(1px 1px at 120px 200px, #eee, transparent),
                radial-gradient(2px 2px at 200px 100px, #fff, transparent),
                radial-gradient(1px 1px at 280px 250px, #ddd, transparent),
                radial-gradient(2px 2px at 350px 50px, #eee, transparent),
                radial-gradient(1px 1px at 420px 220px, #fff, transparent);
            background-repeat: repeat;
            background-size: 600px 350px;
            animation: twinkle 5s ease-in-out infinite;
            animation-delay: 1s;
        }

        .stars-3 {
            background-image:
                radial-gradient(1px 1px at 80px 80px, #fff, transparent),
                radial-gradient(2px 2px at 180px 180px, #eee, transparent),
                radial-gradient(1px 1px at 280px 30px, #ddd, transparent),
                radial-gradient(1px 1px at 380px 280px, #fff, transparent),
                radial-gradient(2px 2px at 480px 130px, #eee, transparent);
            background-repeat: repeat;
            background-size: 550px 320px;
            animation: twinkle 6s ease-in-out infinite;
            animation-delay: 2s;
        }

        @keyframes twinkle {

            0%,
            100% {
                opacity: 0.7;
            }

            50% {
                opacity: 1;
            }
        }

        #container {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* è§†é¢‘éšè—ï¼Œç”¨äºåˆ†æ */
        #videoElement {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            pointer-events: none;
            z-index: -1;
            transform: scaleX(-1);
        }

        /* æ‰‹éƒ¨éª¨æ¶ç”»å¸ƒ */
        #overlayCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            pointer-events: none;
            transform: scaleX(-1);
        }

        /* é£ŸæŒ‡æŒ‡ç¤ºå™¨ */
        #finger-cursor {
            position: fixed;
            width: 30px;
            height: 30px;
            border: 3px solid #00ffff;
            border-radius: 50%;
            pointer-events: none;
            z-index: 150;
            transform: translate(-50%, -50%);
            transition: all 0.1s ease;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        #finger-cursor.clicking {
            background: rgba(255, 215, 0, 0.5);
            border-color: #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            transform: translate(-50%, -50%) scale(1.3);
        }

        /* å…ƒç´ å¡ç‰‡æ ·å¼ - CodePené£æ ¼ */
        .element {
            width: 120px;
            height: 160px;
            background: rgba(0, 127, 127, 0.25);
            box-shadow: 0 0 12px rgba(0, 255, 255, 0.5);
            border: 1px solid rgba(127, 255, 255, 0.25);
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px;
            font-family: Helvetica, sans-serif;
        }

        .element:hover {
            box-shadow: 0 0 12px rgba(0, 255, 255, 0.75);
            border: 1px solid rgba(127, 255, 255, 0.75);
        }

        .element.hovered {
            box-shadow: 0 0 20px rgba(0, 255, 255, 1);
            border: 2px solid rgba(0, 255, 255, 1);
            background: rgba(0, 200, 200, 0.4);
        }

        .element.selected {
            box-shadow: 0 0 25px rgba(255, 200, 0, 0.9);
            border-color: rgba(255, 200, 0, 1);
        }

        .element .number {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 12px;
            color: rgba(127, 255, 255, 0.75);
        }

        .element .symbol {
            font-size: 60px;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.75);
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.95);
            margin-bottom: 0;
            line-height: 1;
        }

        .element .name-cn {
            font-size: 18px;
            color: #ffd700;
            font-weight: bold;
            margin-top: 5px;
            font-family: 'ZCOOL KuaiLe', sans-serif;
        }

        .element .name-en {
            font-size: 12px;
            color: rgba(127, 255, 255, 0.75);
        }

        .element .mass {
            font-size: 12px;
            color: rgba(127, 255, 255, 0.75);
            margin-top: 2px;
        }

        /* UIå±‚ */
        #ui-layer {
            position: absolute;
            inset: 0;
            z-index: 200;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 16px;
        }

        .pointer-events-auto {
            pointer-events: auto;
        }

        /* ç»ç’ƒæ‹Ÿæ€é¢æ¿ */
        .glass-panel {
            background: rgba(0, 30, 60, 0.7);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        /* æŒ‰é’®æ ·å¼ */
        .mode-btn {
            color: rgba(127, 255, 255, 0.75);
            background: transparent;
            border: 1px solid rgba(127, 255, 255, 0.75);
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: Helvetica, sans-serif;
            text-transform: uppercase;
        }

        .mode-btn:hover {
            background: rgba(0, 255, 255, 0.3);
        }

        .mode-btn:active {
            color: #000;
            background: rgba(0, 255, 255, 0.75);
        }

        .mode-btn.active {
            color: #000;
            background: rgba(0, 255, 255, 0.5);
            border-color: #00ffff;
        }

        /* è¿”å›æŒ‰é’® */
        .back-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* åŠ è½½åŠ¨ç”» */
        #loading {
            position: absolute;
            inset: 0;
            background: radial-gradient(ellipse at bottom, #1B2838 0%, #000510 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        .loader {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(0, 255, 255, 0.2);
            border-top-color: #00ffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            color: #ffffff;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(0.8);
            }
        }

        /* å…ƒç´ è¯¦æƒ…å¼¹çª— */
        #element-popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: rgba(0, 40, 60, 0.95);
            border: 2px solid rgba(0, 255, 255, 0.8);
            border-radius: 12px;
            padding: 30px 40px;
            text-align: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 500;
            min-width: 280px;
            box-shadow: 0 0 40px rgba(0, 255, 255, 0.4);
        }

        #element-popup.show {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        #element-popup .popup-symbol {
            font-size: 80px;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
        }

        #element-popup .popup-name-cn {
            font-size: 36px;
            color: #ffd700;
            margin: 10px 0;
        }

        #element-popup .popup-name-en {
            font-size: 18px;
            color: rgba(127, 255, 255, 0.9);
        }

        #element-popup .popup-info {
            margin-top: 15px;
            font-size: 14px;
            color: rgba(200, 200, 200, 0.8);
        }

        #element-popup .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            transition: color 0.3s;
        }

        #element-popup .close-btn:hover {
            color: #ff6b6b;
        }

        /* æ‰‹åŠ¿æç¤º */
        #gesture-hint {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 20px;
            color: #00ffff;
            font-size: 14px;
            z-index: 300;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        #gesture-hint.show {
            opacity: 1;
        }
    </style>

    <!-- Import Maps for ES Modules -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
</head>

<body>

    <!-- æ˜Ÿç©ºèƒŒæ™¯ -->
    <div id="starfield">
        <div class="stars stars-1"></div>
        <div class="stars stars-2"></div>
        <div class="stars stars-3"></div>
    </div>

    <div id="container"></div>
    <video id="videoElement" playsinline autoplay></video>
    <canvas id="overlayCanvas"></canvas>

    <!-- é£ŸæŒ‡æŒ‡ç¤ºå™¨ -->
    <div id="finger-cursor"></div>

    <!-- UI å±‚ -->
    <div id="ui-layer">
        <!-- é¡¶éƒ¨æ  -->
        <div class="flex justify-between items-center w-full pointer-events-auto"
            style="display: flex; justify-content: space-between; align-items: center;">
            <a href="baike_nav.html" class="back-btn glass-panel">ğŸ </a>

            <div style="text-align: center;">
                <h1
                    style="font-size: 24px; color: rgba(127, 255, 255, 0.9); text-shadow: 0 0 10px rgba(0,255,255,0.5);">
                    âš—ï¸ å…ƒç´ å‘¨æœŸè¡¨ 3D
                </h1>
            </div>

            <div class="status-indicator glass-panel pointer-events-auto">
                <span class="status-dot" id="statusDot" style="background: #888;"></span>
                <span id="gestureStatus">åˆå§‹åŒ–ä¸­...</span>
            </div>
        </div>

        <!-- åŠ è½½é®ç½© -->
        <div id="loading">
            <div class="loader"></div>
            <div style="margin-top: 20px; color: #00ffff; font-size: 20px;">æ­£åœ¨å¯åŠ¨å…ƒç´ å‘¨æœŸè¡¨...</div>
            <div style="margin-top: 10px; color: #888; font-size: 14px;">è¯·å…è®¸æ‘„åƒå¤´æƒé™ä»¥ä½¿ç”¨æ‰‹åŠ¿æ§åˆ¶</div>
        </div>

        <!-- åº•éƒ¨æ§åˆ¶é¢æ¿ -->
        <div style="display: flex; justify-content: center; width: 100%;" class="pointer-events-auto">
            <div class="glass-panel"
                style="padding: 10px 16px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                <button id="btn-table" class="mode-btn active" onclick="transformTo('table')">Table</button>
                <button id="btn-sphere" class="mode-btn" onclick="transformTo('sphere')">Sphere</button>
                <button id="btn-helix" class="mode-btn" onclick="transformTo('helix')">Helix</button>
                <button id="btn-grid" class="mode-btn" onclick="transformTo('grid')">Grid</button>
            </div>
        </div>
    </div>

    <!-- æ‰‹åŠ¿æç¤º -->
    <div id="gesture-hint">ğŸ‘† æŒ‡å‘å¼ å˜´é€‰æ‹© | âœŠ æ¡æ‹³å…³é—­ | ğŸ™ƒ æ‘‡å¤´åˆ‡æ¢å¸ƒå±€</div>

    <!-- å…ƒç´ è¯¦æƒ…å¼¹çª— -->
    <div id="element-popup">
        <span class="close-btn" onclick="closePopup()">âœ•</span>
        <div class="popup-symbol" id="popup-symbol">H</div>
        <div class="popup-name-cn" id="popup-name-cn">æ°¢</div>
        <div class="popup-name-en" id="popup-name-en">Hydrogen</div>
        <div class="popup-info" id="popup-info">åŸå­åºæ•°: 1 | åŸå­è´¨é‡: 1.008</div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import TWEEN from 'three/addons/libs/tween.module.js';
        import { CSS3DRenderer, CSS3DObject } from 'three/addons/renderers/CSS3DRenderer.js';
        import { FilesetResolver, HandLandmarker, FaceLandmarker } from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/+esm";

        // ========== å…ƒç´ å‘¨æœŸè¡¨æ•°æ® (ç¬¦å·, è‹±æ–‡å, ä¸­æ–‡å, åŸå­è´¨é‡, åˆ—, è¡Œ) ==========
        const table = [
            'H', 'Hydrogen', 'æ°¢', '1.008', 1, 1,
            'He', 'Helium', 'æ°¦', '4.003', 18, 1,
            'Li', 'Lithium', 'é”‚', '6.941', 1, 2,
            'Be', 'Beryllium', 'é“', '9.012', 2, 2,
            'B', 'Boron', 'ç¡¼', '10.81', 13, 2,
            'C', 'Carbon', 'ç¢³', '12.01', 14, 2,
            'N', 'Nitrogen', 'æ°®', '14.01', 15, 2,
            'O', 'Oxygen', 'æ°§', '16.00', 16, 2,
            'F', 'Fluorine', 'æ°Ÿ', '19.00', 17, 2,
            'Ne', 'Neon', 'æ°–', '20.18', 18, 2,
            'Na', 'Sodium', 'é’ ', '22.99', 1, 3,
            'Mg', 'Magnesium', 'é•', '24.31', 2, 3,
            'Al', 'Aluminium', 'é“', '26.98', 13, 3,
            'Si', 'Silicon', 'ç¡…', '28.09', 14, 3,
            'P', 'Phosphorus', 'ç£·', '30.97', 15, 3,
            'S', 'Sulfur', 'ç¡«', '32.07', 16, 3,
            'Cl', 'Chlorine', 'æ°¯', '35.45', 17, 3,
            'Ar', 'Argon', 'æ°©', '39.95', 18, 3,
            'K', 'Potassium', 'é’¾', '39.10', 1, 4,
            'Ca', 'Calcium', 'é’™', '40.08', 2, 4,
            'Sc', 'Scandium', 'é’ª', '44.96', 3, 4,
            'Ti', 'Titanium', 'é’›', '47.87', 4, 4,
            'V', 'Vanadium', 'é’’', '50.94', 5, 4,
            'Cr', 'Chromium', 'é“¬', '52.00', 6, 4,
            'Mn', 'Manganese', 'é”°', '54.94', 7, 4,
            'Fe', 'Iron', 'é“', '55.85', 8, 4,
            'Co', 'Cobalt', 'é’´', '58.93', 9, 4,
            'Ni', 'Nickel', 'é•', '58.69', 10, 4,
            'Cu', 'Copper', 'é“œ', '63.55', 11, 4,
            'Zn', 'Zinc', 'é”Œ', '65.38', 12, 4,
            'Ga', 'Gallium', 'é•“', '69.72', 13, 4,
            'Ge', 'Germanium', 'é”—', '72.63', 14, 4,
            'As', 'Arsenic', 'ç ·', '74.92', 15, 4,
            'Se', 'Selenium', 'ç¡’', '78.97', 16, 4,
            'Br', 'Bromine', 'æº´', '79.90', 17, 4,
            'Kr', 'Krypton', 'æ°ª', '83.80', 18, 4,
            'Rb', 'Rubidium', 'é“·', '85.47', 1, 5,
            'Sr', 'Strontium', 'é”¶', '87.62', 2, 5,
            'Y', 'Yttrium', 'é’‡', '88.91', 3, 5,
            'Zr', 'Zirconium', 'é”†', '91.22', 4, 5,
            'Nb', 'Niobium', 'é“Œ', '92.91', 5, 5,
            'Mo', 'Molybdenum', 'é’¼', '95.95', 6, 5,
            'Tc', 'Technetium', 'é”', '98', 7, 5,
            'Ru', 'Ruthenium', 'é’Œ', '101.1', 8, 5,
            'Rh', 'Rhodium', 'é“‘', '102.9', 9, 5,
            'Pd', 'Palladium', 'é’¯', '106.4', 10, 5,
            'Ag', 'Silver', 'é“¶', '107.9', 11, 5,
            'Cd', 'Cadmium', 'é•‰', '112.4', 12, 5,
            'In', 'Indium', 'é“Ÿ', '114.8', 13, 5,
            'Sn', 'Tin', 'é”¡', '118.7', 14, 5,
            'Sb', 'Antimony', 'é”‘', '121.8', 15, 5,
            'Te', 'Tellurium', 'ç¢²', '127.6', 16, 5,
            'I', 'Iodine', 'ç¢˜', '126.9', 17, 5,
            'Xe', 'Xenon', 'æ°™', '131.3', 18, 5,
            'Cs', 'Cesium', 'é“¯', '132.9', 1, 6,
            'Ba', 'Barium', 'é’¡', '137.3', 2, 6,
            'La', 'Lanthanum', 'é•§', '138.9', 3, 6,
            'Ce', 'Cerium', 'é“ˆ', '140.1', 4, 6,
            'Pr', 'Praseodymium', 'é•¨', '140.9', 5, 6,
            'Nd', 'Neodymium', 'é’•', '144.2', 6, 6,
            'Pm', 'Promethium', 'é’·', '145', 7, 6,
            'Sm', 'Samarium', 'é’', '150.4', 8, 6,
            'Eu', 'Europium', 'é“•', '152.0', 9, 6,
            'Gd', 'Gadolinium', 'é’†', '157.3', 10, 6,
            'Tb', 'Terbium', 'é“½', '158.9', 11, 6,
            'Dy', 'Dysprosium', 'é•', '162.5', 12, 6,
            'Ho', 'Holmium', 'é’¬', '164.9', 13, 6,
            'Er', 'Erbium', 'é“’', '167.3', 14, 6,
            'Tm', 'Thulium', 'é“¥', '168.9', 15, 6,
            'Yb', 'Ytterbium', 'é•±', '173.0', 16, 6,
            'Lu', 'Lutetium', 'é•¥', '175.0', 17, 6,
            'Hf', 'Hafnium', 'é“ª', '178.5', 18, 6,
            'Ta', 'Tantalum', 'é’½', '180.9', 4, 7,
            'W', 'Tungsten', 'é’¨', '183.8', 5, 7,
            'Re', 'Rhenium', 'é“¼', '186.2', 6, 7,
            'Os', 'Osmium', 'é”‡', '190.2', 7, 7,
            'Ir', 'Iridium', 'é“±', '192.2', 8, 7,
            'Pt', 'Platinum', 'é“‚', '195.1', 9, 7,
            'Au', 'Gold', 'é‡‘', '197.0', 10, 7,
            'Hg', 'Mercury', 'æ±', '200.6', 11, 7,
            'Tl', 'Thallium', 'é“Š', '204.4', 12, 7,
            'Pb', 'Lead', 'é“…', '207.2', 13, 7,
            'Bi', 'Bismuth', 'é“‹', '209.0', 14, 7,
            'Po', 'Polonium', 'é’‹', '209', 15, 7,
            'At', 'Astatine', 'ç ¹', '210', 16, 7,
            'Rn', 'Radon', 'æ°¡', '222', 17, 7,
            'Fr', 'Francium', 'é’«', '223', 18, 7,
            'Ra', 'Radium', 'é•­', '226', 1, 8,
            'Ac', 'Actinium', 'é”•', '227', 2, 8,
            'Th', 'Thorium', 'é’', '232.0', 3, 8,
            'Pa', 'Protactinium', 'é•¤', '231.0', 4, 8,
            'U', 'Uranium', 'é“€', '238.0', 5, 8,
            'Np', 'Neptunium', 'é•', '237', 6, 8,
            'Pu', 'Plutonium', 'é’š', '244', 7, 8,
            'Am', 'Americium', 'é•…', '243', 8, 8,
            'Cm', 'Curium', 'é””', '247', 9, 8,
            'Bk', 'Berkelium', 'é”«', '247', 10, 8,
            'Cf', 'Californium', 'é”', '251', 11, 8,
            'Es', 'Einsteinium', 'é”¿', '252', 12, 8,
            'Fm', 'Fermium', 'é•„', '257', 13, 8,
            'Md', 'Mendelevium', 'é’”', '258', 14, 8,
            'No', 'Nobelium', 'é”˜', '259', 15, 8,
            'Lr', 'Lawrencium', 'é“¹', '266', 16, 8,
            'Rf', 'Rutherfordium', 'ğ¬¬»', '267', 17, 8,
            'Db', 'Dubnium', 'ğ¬­Š', '268', 18, 8,
            'Sg', 'Seaborgium', 'ğ¬­³', '269', 4, 9,
            'Bh', 'Bohrium', 'ğ¬­›', '270', 5, 9,
            'Hs', 'Hassium', 'ğ¬­¶', '277', 6, 9,
            'Mt', 'Meitnerium', 'é¿', '278', 7, 9,
            'Ds', 'Darmstadtium', 'ğ«Ÿ¼', '281', 8, 9,
            'Rg', 'Roentgenium', 'ğ¬¬­', '282', 9, 9,
            'Cn', 'Copernicium', 'é¿”', '285', 10, 9,
            'Nh', 'Nihonium', 'é¿­', '286', 11, 9,
            'Fl', 'Flerovium', 'ğ«“§', '289', 12, 9,
            'Mc', 'Moscovium', 'é•†', '290', 13, 9,
            'Lv', 'Livermorium', 'ğ«Ÿ·', '293', 14, 9,
            'Ts', 'Tennessine', 'çŸ³ç”°', '294', 15, 9,
            'Og', 'Oganesson', 'å¥¥æ°”', '294', 16, 9
        ];

        // ========== å…¨å±€å˜é‡ ==========
        let camera, scene, renderer;
        let controls = {
            rotationX: 0,
            rotationY: 0,
            targetRotationX: 0,
            targetRotationY: 0,
            zoom: 3000,
            targetZoom: 3000
        };
        let objects = [];
        let targets = { table: [], sphere: [], helix: [], grid: [] };
        let currentTarget = 'table';

        // MediaPipe
        let handLandmarker = null;
        let faceLandmarker = null;
        let lastVideoTime = -1;
        let lastFaceTime = -1;
        let videoReady = false;
        const video = document.getElementById('videoElement');
        const overlayCanvas = document.getElementById('overlayCanvas');
        const overlayCtx = overlayCanvas.getContext('2d');
        const loadingScreen = document.getElementById('loading');
        const gestureStatus = document.getElementById('gestureStatus');
        const statusDot = document.getElementById('statusDot');
        const gestureHint = document.getElementById('gesture-hint');
        const fingerCursor = document.getElementById('finger-cursor');

        // æ‰‹åŠ¿çŠ¶æ€
        let handState = {
            hasHand: false,
            palmX: 0.5,
            palmY: 0.5,
            prevPalmX: 0.5,
            prevPalmY: 0.5,
            indexX: 0.5,
            indexY: 0.5,
            isPointing: false,  // é£ŸæŒ‡ä¼¸å‡ºçŠ¶æ€
            isFist: false,      // æ¡æ‹³çŠ¶æ€
            wasFist: false,
            hoveredElement: null,
            lastClickTime: 0
        };

        // é¢éƒ¨çŠ¶æ€
        let faceState = {
            hasFace: false,
            mouthOpen: false,
            wasMouthOpen: false,
            headRotationY: 0,       // å¤´éƒ¨å·¦å³æ—‹è½¬ (-1 åˆ° 1)
            currentLayoutIndex: 0,  // å½“å‰å¸ƒå±€ç´¢å¼•
            lastLayoutChangeTime: 0
        };

        // å¸ƒå±€æ¨¡å¼åˆ—è¡¨
        const layoutModes = ['table', 'sphere', 'helix', 'grid'];

        // ========== åˆå§‹åŒ– ==========
        init();
        initMediaPipe();

        function init() {
            camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 10000);
            camera.position.z = controls.zoom;

            scene = new THREE.Scene();

            // åˆ›å»ºå…ƒç´ å¡ç‰‡
            for (let i = 0; i < table.length; i += 6) {
                const element = document.createElement('div');
                element.className = 'element';
                element.dataset.index = i / 6;
                element.dataset.symbol = table[i];
                element.dataset.nameCn = table[i + 2];
                element.dataset.nameEn = table[i + 1];
                element.dataset.mass = table[i + 3];

                const number = document.createElement('div');
                number.className = 'number';
                number.textContent = (i / 6) + 1;
                element.appendChild(number);

                const symbol = document.createElement('div');
                symbol.className = 'symbol';
                symbol.textContent = table[i];
                element.appendChild(symbol);

                const nameCn = document.createElement('div');
                nameCn.className = 'name-cn';
                nameCn.textContent = table[i + 2];
                element.appendChild(nameCn);

                const nameEn = document.createElement('div');
                nameEn.className = 'name-en';
                nameEn.textContent = table[i + 1];
                element.appendChild(nameEn);

                const mass = document.createElement('div');
                mass.className = 'mass';
                mass.textContent = table[i + 3];
                element.appendChild(mass);

                // ç‚¹å‡»äº‹ä»¶
                element.addEventListener('click', () => onElementClick(element));

                const objectCSS = new CSS3DObject(element);
                objectCSS.position.x = Math.random() * 4000 - 2000;
                objectCSS.position.y = Math.random() * 4000 - 2000;
                objectCSS.position.z = Math.random() * 4000 - 2000;
                scene.add(objectCSS);

                objects.push(objectCSS);

                // Table å¸ƒå±€ç›®æ ‡
                const object = new THREE.Object3D();
                object.position.x = (table[i + 4] * 140) - 1330;
                object.position.y = -(table[i + 5] * 180) + 990;
                targets.table.push(object);
            }

            // Sphere å¸ƒå±€
            const vector = new THREE.Vector3();
            for (let i = 0, l = objects.length; i < l; i++) {
                const phi = Math.acos(-1 + (2 * i) / l);
                const theta = Math.sqrt(l * Math.PI) * phi;

                const object = new THREE.Object3D();
                object.position.setFromSphericalCoords(800, phi, theta);
                vector.copy(object.position).multiplyScalar(2);
                object.lookAt(vector);

                targets.sphere.push(object);
            }

            // Helix å¸ƒå±€
            for (let i = 0, l = objects.length; i < l; i++) {
                const theta = i * 0.175 + Math.PI;
                const y = -(i * 8) + 450;

                const object = new THREE.Object3D();
                object.position.setFromCylindricalCoords(900, theta, y);

                vector.x = object.position.x * 2;
                vector.y = object.position.y;
                vector.z = object.position.z * 2;
                object.lookAt(vector);

                targets.helix.push(object);
            }

            // Grid å¸ƒå±€
            for (let i = 0; i < objects.length; i++) {
                const object = new THREE.Object3D();
                object.position.x = ((i % 5) * 400) - 800;
                object.position.y = (-(Math.floor(i / 5) % 5) * 400) + 800;
                object.position.z = (Math.floor(i / 25)) * 1000 - 2000;

                targets.grid.push(object);
            }

            renderer = new CSS3DRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('container').appendChild(renderer.domElement);

            // åˆå§‹å˜æ¢åˆ°è¡¨æ ¼å¸ƒå±€ (å¿«é€ŸåŠ¨ç”» 800ms)
            transform(targets.table, 800);

            window.addEventListener('resize', onWindowResize);

            // é¼ æ ‡/è§¦æ‘¸æ§åˆ¶ä½œä¸ºå¤‡é€‰
            setupMouseControls();

            // å¼€å§‹åŠ¨ç”»å¾ªç¯
            animate();
        }

        function setupMouseControls() {
            const container = renderer.domElement;
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };

            container.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });

            container.addEventListener('mousemove', (e) => {
                if (!isDragging || handState.hasHand) return;

                const deltaX = e.clientX - previousMousePosition.x;
                const deltaY = e.clientY - previousMousePosition.y;

                controls.targetRotationY += deltaX * 0.005;
                controls.targetRotationX += deltaY * 0.005;

                previousMousePosition = { x: e.clientX, y: e.clientY };
            });

            container.addEventListener('mouseup', () => isDragging = false);
            container.addEventListener('mouseleave', () => isDragging = false);

            container.addEventListener('wheel', (e) => {
                if (handState.hasHand) return;
                controls.targetZoom += e.deltaY * 2;
                controls.targetZoom = Math.max(1000, Math.min(6000, controls.targetZoom));
            });

            // è§¦æ‘¸æ”¯æŒ
            let touchStart = null;
            container.addEventListener('touchstart', (e) => {
                if (e.touches.length === 1) {
                    touchStart = { x: e.touches[0].clientX, y: e.touches[0].clientY };
                }
            });

            container.addEventListener('touchmove', (e) => {
                if (!touchStart || handState.hasHand) return;

                const deltaX = e.touches[0].clientX - touchStart.x;
                const deltaY = e.touches[0].clientY - touchStart.y;

                controls.targetRotationY += deltaX * 0.005;
                controls.targetRotationX += deltaY * 0.005;

                touchStart = { x: e.touches[0].clientX, y: e.touches[0].clientY };
            });

            container.addEventListener('touchend', () => touchStart = null);
        }

        // ========== MediaPipe åˆå§‹åŒ– ==========
        async function initMediaPipe() {
            try {
                const vision = await FilesetResolver.forVisionTasks(
                    "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm"
                );

                // æ‰‹éƒ¨è¯†åˆ«
                handLandmarker = await HandLandmarker.createFromOptions(vision, {
                    baseOptions: {
                        modelAssetPath: "https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task",
                        delegate: "GPU"
                    },
                    runningMode: "VIDEO",
                    numHands: 1
                });

                // é¢éƒ¨è¯†åˆ« (ç”¨äºå¼ å˜´æ£€æµ‹)
                faceLandmarker = await FaceLandmarker.createFromOptions(vision, {
                    baseOptions: {
                        modelAssetPath: "https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",
                        delegate: "GPU"
                    },
                    runningMode: "VIDEO",
                    numFaces: 1,
                    outputFaceBlendshapes: true
                });

                startCamera();
            } catch (error) {
                console.error("MediaPipe Init Error:", error);
                gestureStatus.textContent = "æ‰‹åŠ¿åˆå§‹åŒ–å¤±è´¥";
                statusDot.style.background = "#ff4444";
                hideLoading();
            }
        }

        async function startCamera() {
            try {
                const constraints = { video: { facingMode: "user", width: 640, height: 480 } };
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;

                // ç­‰å¾…è§†é¢‘çœŸæ­£å‡†å¤‡å¥½
                video.addEventListener("loadeddata", () => {
                    // ç¡®ä¿è§†é¢‘æœ‰å°ºå¯¸
                    if (video.videoWidth > 0 && video.videoHeight > 0) {
                        videoReady = true;
                        hideLoading();
                        gestureStatus.textContent = "æ‰‹åŠ¿å°±ç»ª";
                        statusDot.style.background = "#00ff88";
                    }
                });

                // å¤‡ç”¨æ£€æµ‹
                video.addEventListener("playing", () => {
                    setTimeout(() => {
                        if (video.videoWidth > 0 && video.videoHeight > 0) {
                            videoReady = true;
                            hideLoading();
                        }
                    }, 500);
                });
            } catch (error) {
                console.error("Camera Error:", error);
                gestureStatus.textContent = "æ‘„åƒå¤´è®¿é—®å¤±è´¥";
                statusDot.style.background = "#ff4444";
                hideLoading();
            }
        }

        function hideLoading() {
            loadingScreen.style.opacity = '0';
            setTimeout(() => loadingScreen.style.display = 'none', 500);
        }

        // ========== æ‰‹åŠ¿å¤„ç† ==========
        function processHandGesture() {
            // ç¡®ä¿è§†é¢‘å·²å‡†å¤‡å¥½ä¸”æœ‰æœ‰æ•ˆå°ºå¯¸
            if (!handLandmarker || !videoReady) return;
            if (video.videoWidth === 0 || video.videoHeight === 0) return;
            if (video.currentTime === lastVideoTime) return;

            lastVideoTime = video.currentTime;

            try {
                const result = handLandmarker.detectForVideo(video, performance.now());

                overlayCanvas.width = window.innerWidth;
                overlayCanvas.height = window.innerHeight;
                overlayCtx.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);

                if (result.landmarks && result.landmarks.length > 0) {
                    handState.hasHand = true;
                    const landmarks = result.landmarks[0];

                    drawSkeleton(overlayCtx, landmarks);

                    // ä¿å­˜ä¸Šä¸€å¸§ä½ç½®
                    handState.prevPalmX = handState.palmX;
                    handState.prevPalmY = handState.palmY;

                    // è®¡ç®—æ‰‹æŒä¸­å¿ƒ
                    const wrist = landmarks[0];
                    const middleBase = landmarks[9];
                    handState.palmX = (wrist.x + middleBase.x) / 2;
                    handState.palmY = (wrist.y + middleBase.y) / 2;

                    // æ£€æµ‹é£ŸæŒ‡ä¼¸å‡º (pointing) - é£ŸæŒ‡ä¼¸ç›´ï¼Œå…¶ä»–æ‰‹æŒ‡å¼¯æ›²
                    const indexTip = landmarks[8];
                    const indexPip = landmarks[6];
                    const middleTip = landmarks[12];
                    const middlePip = landmarks[10];
                    const ringTip = landmarks[16];
                    const ringPip = landmarks[14];
                    const pinkyTip = landmarks[20];
                    const pinkyPip = landmarks[18];

                    const indexExtended = indexTip.y < indexPip.y - 0.02;
                    const middleCurled = middleTip.y > middlePip.y;
                    const ringCurled = ringTip.y > ringPip.y;
                    const pinkyCurled = pinkyTip.y > pinkyPip.y;

                    handState.isPointing = indexExtended && middleCurled && ringCurled && pinkyCurled;

                    // æ£€æµ‹æ¡æ‹³
                    handState.wasFist = handState.isFist;
                    const thumbTip = landmarks[4];
                    const allFingersCurled = !indexExtended && middleCurled && ringCurled && pinkyCurled;
                    const thumbNearPalm = Math.hypot(thumbTip.x - middleBase.x, thumbTip.y - middleBase.y) < 0.15;
                    handState.isFist = allFingersCurled && thumbNearPalm;

                    // æ¡æ‹³å…³é—­å¼¹çª—
                    if (handState.isFist && !handState.wasFist) {
                        closePopup();
                    }

                    // é£ŸæŒ‡ä½ç½® (ç”¨äºé€‰æ‹©å…ƒç´ )
                    handState.indexX = 1 - indexTip.x; // é•œåƒ
                    handState.indexY = indexTip.y;

                    if (handState.isPointing) {
                        // æŒ‡å‘æ¨¡å¼: åªç§»åŠ¨å…‰æ ‡é€‰æ‹©å…ƒç´ ï¼Œä¸æ—‹è½¬è¡¨
                        const cursorX = handState.indexX * window.innerWidth;
                        const cursorY = handState.indexY * window.innerHeight;
                        fingerCursor.style.left = cursorX + 'px';
                        fingerCursor.style.top = cursorY + 'px';
                        fingerCursor.style.display = 'block';

                        // æŸ¥æ‰¾é£ŸæŒ‡æ‚¬åœçš„å…ƒç´ 
                        findHoveredElement(cursorX, cursorY);

                        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                        if (handState.hoveredElement) {
                            statusDot.style.background = '#00ffff';
                            statusDot.style.boxShadow = '0 0 10px #00ffff';
                            gestureStatus.textContent = 'ğŸ‘† ' + handState.hoveredElement.dataset.nameCn + ' - å¼ å˜´é€‰æ‹©';
                            gestureHint.classList.add('show');
                        } else {
                            statusDot.style.background = '#00ff88';
                            statusDot.style.boxShadow = '0 0 10px #00ff88';
                            gestureStatus.textContent = 'â˜ï¸ æŒ‡å‘é€‰æ‹©æ¨¡å¼';
                            gestureHint.classList.remove('show');
                        }
                    } else if (handState.isFist) {
                        // æ¡æ‹³æ¨¡å¼
                        fingerCursor.style.display = 'none';
                        clearHoveredElements();
                        statusDot.style.background = '#ff6b6b';
                        statusDot.style.boxShadow = '0 0 10px #ff6b6b';
                        gestureStatus.textContent = 'âœŠ æ¡æ‹³ - å…³é—­';
                        gestureHint.classList.remove('show');
                    } else {
                        // æ‰‹æŒæ¨¡å¼
                        fingerCursor.style.display = 'none';
                        clearHoveredElements();

                        // åªæœ‰é TABLE å¸ƒå±€æ‰æ”¯æŒæ‰‹åŠ¿æ—‹è½¬
                        if (currentTarget !== 'table') {
                            const deltaX = handState.palmX - handState.prevPalmX;
                            const deltaY = handState.palmY - handState.prevPalmY;
                            const rotationSpeed = 8;
                            controls.targetRotationY -= deltaX * rotationSpeed;
                            controls.targetRotationX += deltaY * rotationSpeed * 0.5;

                            statusDot.style.background = '#00ff88';
                            statusDot.style.boxShadow = '0 0 10px #00ff88';
                            gestureStatus.textContent = 'âœ‹ æ‰‹æŒæ—‹è½¬æ¨¡å¼';
                        } else {
                            statusDot.style.background = '#888';
                            statusDot.style.boxShadow = 'none';
                            gestureStatus.textContent = 'ğŸ“Š è¡¨æ ¼æ¨¡å¼ - æ‘‡å¤´åˆ‡æ¢';
                        }
                        gestureHint.classList.remove('show');
                    }

                } else {
                    handState.hasHand = false;
                    handState.isPointing = false;
                    handState.isFist = false;
                    handState.hoveredElement = null;
                    fingerCursor.style.display = 'none';
                    clearHoveredElements();
                    statusDot.style.background = '#888';
                    statusDot.style.boxShadow = 'none';
                    gestureStatus.textContent = 'æœªæ£€æµ‹åˆ°æ‰‹åŠ¿';
                    gestureHint.classList.remove('show');
                }
            } catch (error) {
                console.warn("Hand detection error:", error.message);
            }
        }

        // ========== é¢éƒ¨å¤„ç† (å¼ å˜´æ£€æµ‹) ==========
        function processFaceGesture() {
            if (!faceLandmarker || !videoReady) return;
            if (video.videoWidth === 0 || video.videoHeight === 0) return;

            try {
                const result = faceLandmarker.detectForVideo(video, performance.now());

                if (result.faceBlendshapes && result.faceBlendshapes.length > 0) {
                    faceState.hasFace = true;
                    const blendshapes = result.faceBlendshapes[0].categories;

                    // æŸ¥æ‰¾å¼ å˜´ç¨‹åº¦
                    const jawOpen = blendshapes.find(b => b.categoryName === 'jawOpen');
                    const mouthOpenScore = jawOpen ? jawOpen.score : 0;

                    faceState.wasMouthOpen = faceState.mouthOpen;
                    faceState.mouthOpen = mouthOpenScore > 0.3; // é˜ˆå€¼

                    // å¼ å˜´è§¦å‘ç‚¹å‡»
                    if (faceState.mouthOpen && !faceState.wasMouthOpen) {
                        const now = Date.now();
                        if (now - handState.lastClickTime > 500) {
                            handState.lastClickTime = now;
                            if (handState.hoveredElement && handState.isPointing) {
                                fingerCursor.classList.add('clicking');
                                setTimeout(() => fingerCursor.classList.remove('clicking'), 300);
                                onElementClick(handState.hoveredElement);
                            }
                        }
                    }

                    // å¤´éƒ¨å·¦å³æ—‹è½¬æ£€æµ‹ (ä½¿ç”¨ headYaw blendshape æˆ–é¢éƒ¨landmarkä½ç½®)
                    // ä½¿ç”¨ eyeLookOutLeft/Right æ¥ä¼°ç®—å¤´éƒ¨æ—‹è½¬
                    const headTurnLeft = blendshapes.find(b => b.categoryName === 'headTurnLeft');
                    const headTurnRight = blendshapes.find(b => b.categoryName === 'headTurnRight');

                    let headYaw = 0;
                    if (headTurnLeft && headTurnRight) {
                        headYaw = (headTurnRight.score - headTurnLeft.score);
                    }
                    faceState.headRotationY = headYaw;

                    // æ ¹æ®å¤´éƒ¨æ—‹è½¬åˆ‡æ¢å¸ƒå±€æ¨¡å¼
                    const now = Date.now();
                    const layoutChangeThreshold = 0.4; // æ—‹è½¬é˜ˆå€¼
                    const layoutChangeCooldown = 800;  // åˆ‡æ¢å†·å´æ—¶é—´

                    if (now - faceState.lastLayoutChangeTime > layoutChangeCooldown) {
                        if (headYaw > layoutChangeThreshold) {
                            // å‘å³è½¬ - ä¸‹ä¸€ä¸ªå¸ƒå±€
                            faceState.currentLayoutIndex = (faceState.currentLayoutIndex + 1) % 4;
                            transformTo(layoutModes[faceState.currentLayoutIndex]);
                            faceState.lastLayoutChangeTime = now;
                        } else if (headYaw < -layoutChangeThreshold) {
                            // å‘å·¦è½¬ - ä¸Šä¸€ä¸ªå¸ƒå±€
                            faceState.currentLayoutIndex = (faceState.currentLayoutIndex + 3) % 4;
                            transformTo(layoutModes[faceState.currentLayoutIndex]);
                            faceState.lastLayoutChangeTime = now;
                        }
                    }
                } else {
                    faceState.hasFace = false;
                    faceState.mouthOpen = false;
                }
            } catch (error) {
                // å¿½ç•¥é¢éƒ¨æ£€æµ‹é”™è¯¯
            }
        }

        function findHoveredElement(cursorX, cursorY) {
            let closestElement = null;
            let closestDist = 100; // æœ€å¤§è·ç¦»é˜ˆå€¼

            objects.forEach(obj => {
                const screenPos = obj.position.clone().project(camera);
                const screenX = (screenPos.x + 1) / 2 * window.innerWidth;
                const screenY = (-screenPos.y + 1) / 2 * window.innerHeight;

                const dist = Math.hypot(screenX - cursorX, screenY - cursorY);
                if (dist < closestDist && screenPos.z < 1 && screenPos.z > -1) {
                    closestDist = dist;
                    closestElement = obj.element;
                }
            });

            // æ¸…é™¤ä¹‹å‰çš„é«˜äº®
            if (handState.hoveredElement && handState.hoveredElement !== closestElement) {
                handState.hoveredElement.classList.remove('hovered');
            }

            // æ›´æ–°å½“å‰æ‚¬åœå…ƒç´ 
            handState.hoveredElement = closestElement;
            if (closestElement) {
                closestElement.classList.add('hovered');
            }
        }

        function clearHoveredElements() {
            document.querySelectorAll('.element.hovered').forEach(el => el.classList.remove('hovered'));
        }

        function drawSkeleton(ctx, landmarks) {
            const w = ctx.canvas.width;
            const h = ctx.canvas.height;

            ctx.lineWidth = 3;
            ctx.lineCap = 'round';

            let color = 'rgba(0, 255, 200, 0.8)';
            if (handState.isPointing) color = 'rgba(0, 255, 255, 0.9)';
            else if (handState.isFist) color = 'rgba(255, 107, 107, 0.9)';
            ctx.strokeStyle = color;

            const fingers = [
                [0, 1, 2, 3, 4],
                [0, 5, 6, 7, 8],
                [5, 9, 10, 11, 12],
                [9, 13, 14, 15, 16],
                [13, 17, 18, 19, 20]
            ];

            fingers.forEach(chain => {
                ctx.beginPath();
                ctx.moveTo(landmarks[chain[0]].x * w, landmarks[chain[0]].y * h);
                for (let i = 1; i < chain.length; i++) {
                    ctx.lineTo(landmarks[chain[i]].x * w, landmarks[chain[i]].y * h);
                }
                ctx.stroke();
            });

            // è¿æ¥æ‰‹æŒ
            ctx.beginPath();
            ctx.moveTo(landmarks[0].x * w, landmarks[0].y * h);
            ctx.lineTo(landmarks[5].x * w, landmarks[5].y * h);
            ctx.lineTo(landmarks[9].x * w, landmarks[9].y * h);
            ctx.lineTo(landmarks[13].x * w, landmarks[13].y * h);
            ctx.lineTo(landmarks[17].x * w, landmarks[17].y * h);
            ctx.lineTo(landmarks[0].x * w, landmarks[0].y * h);
            ctx.stroke();

            // ç»˜åˆ¶å…³èŠ‚ç‚¹
            ctx.fillStyle = '#ffffff';
            landmarks.forEach(lm => {
                ctx.beginPath();
                ctx.arc(lm.x * w, lm.y * h, 4, 0, Math.PI * 2);
                ctx.fill();
            });

            // é«˜äº®é£ŸæŒ‡å°–
            ctx.fillStyle = handState.isPointing ? '#00ffff' : '#ffffff';
            ctx.beginPath();
            ctx.arc(landmarks[8].x * w, landmarks[8].y * h, 8, 0, Math.PI * 2);
            ctx.fill();
        }

        // ========== å…ƒç´ ç‚¹å‡»å¤„ç† ==========
        function onElementClick(element) {
            const symbol = element.dataset.symbol;
            const nameCn = element.dataset.nameCn;
            const nameEn = element.dataset.nameEn;
            const mass = element.dataset.mass;
            const index = parseInt(element.dataset.index) + 1;

            // æ›´æ–°å¼¹çª—
            document.getElementById('popup-symbol').textContent = symbol;
            document.getElementById('popup-name-cn').textContent = nameCn;
            document.getElementById('popup-name-en').textContent = nameEn;
            document.getElementById('popup-info').textContent = `åŸå­åºæ•°: ${index} | åŸå­è´¨é‡: ${mass}`;

            // æ˜¾ç¤ºå¼¹çª—
            document.getElementById('element-popup').classList.add('show');

            // é«˜äº®å…ƒç´ 
            document.querySelectorAll('.element').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');

            // æœ—è¯»ä¸­æ–‡åç§°
            speakChineseName(nameCn);
        }

        function speakChineseName(name) {
            if ('speechSynthesis' in window) {
                // åœæ­¢ä¹‹å‰çš„è¯­éŸ³
                speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(name);
                utterance.lang = 'zh-CN';
                utterance.rate = 0.8;
                utterance.pitch = 1.1;
                utterance.volume = 1;

                speechSynthesis.speak(utterance);
            }
        }

        window.closePopup = function () {
            document.getElementById('element-popup').classList.remove('show');
            document.querySelectorAll('.element').forEach(el => el.classList.remove('selected'));
        };

        // ========== å¸ƒå±€å˜æ¢ (æ›´å¿«çš„åŠ¨ç”») ==========
        window.transformTo = function (targetName) {
            currentTarget = targetName;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-' + targetName).classList.add('active');

            // å¿«é€ŸåŠ¨ç”» 600ms (åŸæ¥æ˜¯ 2000ms)
            transform(targets[targetName], 600);
        };

        function transform(targetArray, duration) {
            TWEEN.removeAll();

            for (let i = 0; i < objects.length; i++) {
                const object = objects[i];
                const target = targetArray[i];

                new TWEEN.Tween(object.position)
                    .to({ x: target.position.x, y: target.position.y, z: target.position.z }, Math.random() * duration + duration)
                    .easing(TWEEN.Easing.Exponential.InOut)
                    .start();

                new TWEEN.Tween(object.rotation)
                    .to({ x: target.rotation.x, y: target.rotation.y, z: target.rotation.z }, Math.random() * duration + duration)
                    .easing(TWEEN.Easing.Exponential.InOut)
                    .start();
            }
        }

        // ========== çª—å£è°ƒæ•´ ==========
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // ========== åŠ¨ç”»å¾ªç¯ ==========
        function animate() {
            requestAnimationFrame(animate);

            processHandGesture();
            processFaceGesture();
            TWEEN.update();

            // å¹³æ»‘è¿‡æ¸¡æ—‹è½¬
            controls.rotationX += (controls.targetRotationX - controls.rotationX) * 0.08;
            controls.rotationY += (controls.targetRotationY - controls.rotationY) * 0.08;

            // åº”ç”¨æ—‹è½¬åˆ°åœºæ™¯
            scene.rotation.x = controls.rotationX;
            scene.rotation.y = controls.rotationY;

            // æ›´æ–°ç›¸æœºè·ç¦»
            controls.zoom += (controls.targetZoom - controls.zoom) * 0.05;
            camera.position.z = controls.zoom;

            renderer.render(scene, camera);
        }
    </script>
</body>

</html>