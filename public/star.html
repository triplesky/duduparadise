
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çŸ¥è¯†ç™¾ç§‘ - å¤ªé˜³ç³» 3D</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
    <!-- å¼•å…¥ Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- å¼•å…¥ OrbitControls -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'ZCOOL KuaiLe', cursive, sans-serif;
            background-color: #000;
            user-select: none;
        }
        
        /* éšè—æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar { display: none; }

        /* UI å±‚ */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .pointer-events-auto {
            pointer-events: auto;
        }

        /* å¼¹çª—æ ·å¼ */
        #planet-modal {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        
        /* éœ“è™¹æ–‡å­— */
        .neon-text {
            text-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff;
        }

        /* 3D Canvas */
        #canvas-container {
            width: 100vw;
            height: 100vh;
            display: block;
        }

        /* å¼¹çª—å†…çš„ 3D å®¹å™¨ */
        #modal-3d-container {
            width: 100%;
            height: 300px;
            background: radial-gradient(circle at center, #1a202c 0%, #000000 100%);
            border-radius: 1rem;
            overflow: hidden;
            cursor: move;
        }
    </style>
</head>
<body>

    <!-- ä¸» 3D ç”»å¸ƒå®¹å™¨ -->
    <div id="canvas-container"></div>

    <!-- UI è¦†ç›–å±‚ -->
    <div id="ui-layer" class="flex flex-col justify-between p-4">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="flex justify-between items-start pointer-events-auto">
            <a href="baike_nav.html" class="bg-white/10 backdrop-blur border-2 border-cyan-400 rounded-full w-12 h-12 flex items-center justify-center text-2xl shadow-[0_0_15px_rgba(34,211,238,0.5)] hover:bg-cyan-400 hover:text-black transition-all no-underline text-white">
                ğŸ 
            </a>
            <div class="text-center">
                <h1 class="text-4xl md:text-5xl text-transparent bg-clip-text bg-gradient-to-r from-cyan-300 to-blue-500 font-bold drop-shadow-lg">
                    å¤ªé˜³ç³»ç™¾ç§‘
                </h1>
                <p class="text-cyan-200 text-sm opacity-80 mt-1">ç‚¹å‡»æ˜Ÿçƒæ¢ç´¢å¥¥ç§˜</p>
            </div>
            <!-- å ä½ï¼Œä¿æŒå¹³è¡¡ -->
            <div class="w-12"></div>
        </div>

        <!-- åº•éƒ¨æç¤º -->
        <div class="text-center pb-4 opacity-50 text-white text-sm pointer-events-none">
            æ‹–æ‹½æ—‹è½¬è§†è§’ â€¢ æ»šè½®ç¼©æ”¾ â€¢ ç‚¹å‡»æ˜Ÿçƒ
        </div>
    </div>

    <!-- æ˜Ÿçƒè¯¦æƒ…å¼¹çª— -->
    <div id="planet-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm hidden opacity-0 scale-95 pointer-events-auto">
        <div class="bg-gray-900 border-2 border-cyan-500 rounded-3xl w-11/12 max-w-2xl p-6 relative shadow-[0_0_50px_rgba(6,182,212,0.3)]">
            
            <!-- å…³é—­æŒ‰é’® -->
            <button onclick="closeModal()" class="absolute top-4 right-4 bg-red-500 hover:bg-red-600 text-white rounded-full w-10 h-10 flex items-center justify-center border-2 border-white/20 transition-transform active:scale-90 z-20">
                âœ•
            </button>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- å·¦ä¾§ï¼š3D æ¨¡å‹å±•ç¤ºåŒº -->
                <div class="flex flex-col">
                    <div id="modal-3d-container" class="border border-gray-700 shadow-inner relative">
                        <!-- è¿™é‡Œçš„ Canvas ç”± JS åŠ¨æ€æ’å…¥ -->
                        <div class="absolute bottom-2 right-2 text-xs text-white/30 pointer-events-none">æ‹–æ‹½æ—‹è½¬</div>
                    </div>
                </div>

                <!-- å³ä¾§ï¼šæ–‡å­—ä¿¡æ¯ -->
                <div class="text-white flex flex-col justify-center">
                    <h2 id="modal-title" class="text-3xl font-bold mb-1 text-cyan-400">Earth</h2>
                    <div class="text-sm text-yellow-400 mb-4 font-sans tracking-widest border-b border-gray-700 pb-2" id="modal-subtitle">The Blue Planet</div>
                    
                    <div class="space-y-3 text-lg leading-relaxed text-gray-200 h-40 overflow-y-auto pr-2 custom-scrollbar" id="modal-desc">
                        åœ°çƒæ˜¯æˆ‘ä»¬å…±åŒçš„å®¶å›­ï¼Œæ˜¯ç›®å‰å®‡å®™ä¸­å·²çŸ¥å”¯ä¸€å­˜åœ¨ç”Ÿå‘½çš„æ˜Ÿçƒã€‚å®ƒæ‹¥æœ‰ä¸°å¯Œçš„æ°´èµ„æºå’Œé€‚å®œçš„å¤§æ°”å±‚ã€‚
                    </div>

                    <div class="mt-6 grid grid-cols-2 gap-4 text-center">
                        <div class="bg-white/5 rounded-lg p-2">
                            <div class="text-xs text-gray-500">å…¬è½¬å‘¨æœŸ</div>
                            <div class="text-xl text-cyan-300 font-bold" id="modal-year">365 å¤©</div>
                        </div>
                        <div class="bg-white/5 rounded-lg p-2">
                            <div class="text-xs text-gray-500">å¹³å‡æ¸©åº¦</div>
                            <div class="text-xl text-yellow-300 font-bold" id="modal-temp">15Â°C</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- è¡Œæ˜Ÿæ•°æ® ---
        // color å­—æ®µç”¨äºåŸºç¡€è‰²ï¼Œç”Ÿæˆçº¹ç†æ—¶ä¼šåŸºäºæ­¤è‰²è°ƒ
        const planetsData = [
            {
                name: "å¤ªé˜³", english: "Sun", feature: "ä¸‡ç‰©ä¹‹æº Â· æ’æ˜Ÿ",
                color: 0xffaa00, size: 12, distance: 0, speed: 0,
                desc: "å¤ªé˜³æ˜¯å¤ªé˜³ç³»çš„ä¸­å¿ƒï¼Œä¸€é¢—å·¨å¤§çš„æ’æ˜Ÿã€‚å®ƒä¸»è¦ç”±æ°¢å’Œæ°¦ç»„æˆï¼Œè¡¨é¢æ¸©åº¦é«˜è¾¾5500Â°Cã€‚å®ƒæä¾›äº†å…‰å’Œçƒ­ï¼Œæ˜¯åœ°çƒä¸Šç”Ÿå‘½å­˜åœ¨çš„æºæ³‰ã€‚å®ƒçš„å¼•åŠ›å·¨å¤§ï¼Œç‰µå¼•ç€å…«å¤§è¡Œæ˜Ÿå›´ç»•å®ƒæ—‹è½¬ã€‚",
                year: "--", temp: "5500Â°C", type: 'star'
            },
            {
                name: "æ°´æ˜Ÿ", english: "Mercury", feature: "æ»¡è„¸é™¨çŸ³å‘",
                color: 0xa1a1a1, size: 1.5, distance: 20, speed: 0.04,
                desc: "æ°´æ˜Ÿæ˜¯ç¦»å¤ªé˜³æœ€è¿‘çš„è¡Œæ˜Ÿï¼Œä¹Ÿæ˜¯å¤ªé˜³ç³»ä¸­æœ€å°çš„è¡Œæ˜Ÿã€‚å®ƒæ²¡æœ‰å¤§æ°”å±‚ä¿æŠ¤ï¼Œæ‰€ä»¥è¡¨é¢å¸ƒæ»¡äº†é™¨çŸ³å‘ï¼Œåƒæœˆçƒä¸€æ ·ã€‚å®ƒçš„æ¸©å·®æå¤§ï¼Œç™½å¤©æ‘„æ°430åº¦ï¼Œæ™šä¸Šé™è‡³é›¶ä¸‹170åº¦ã€‚",
                year: "88 å¤©", temp: "167Â°C", type: 'rocky'
            },
            {
                name: "é‡‘æ˜Ÿ", english: "Venus", feature: "è¶…çº§æ¸©å®¤æ•ˆåº”",
                color: 0xffcc00, size: 3.5, distance: 30, speed: 0.015,
                desc: "é‡‘æ˜Ÿè¢«ç§°ä¸ºåœ°çƒçš„â€œå§å¦¹æ˜Ÿâ€ï¼Œå› ä¸ºå¤§å°å¾ˆåƒã€‚ä½†å®ƒéå¸¸å¯æ€•ï¼Œè¢«åšåšçš„äºŒæ°§åŒ–ç¢³å¤§æ°”å±‚åŒ…è£¹ï¼Œå¯¼è‡´ä¸¥é‡çš„æ¸©å®¤æ•ˆåº”ï¼Œè¡¨é¢æ¸©åº¦é«˜è¾¾464Â°Cï¼Œæ˜¯å¤ªé˜³ç³»æœ€çƒ­çš„è¡Œæ˜Ÿï¼è€Œä¸”å®ƒæ˜¯å€’ç€è½¬çš„å“¦ã€‚",
                year: "225 å¤©", temp: "464Â°C", type: 'gas'
            },
            {
                name: "åœ°çƒ", english: "Earth", feature: "ç”Ÿå‘½çš„æ‘‡ç¯®",
                color: 0x2233ff, size: 3.8, distance: 45, speed: 0.01,
                desc: "åœ°çƒæ˜¯æˆ‘ä»¬å…±åŒçš„å®¶å›­ï¼Œä¹Ÿæ˜¯ç›®å‰å·²çŸ¥å”¯ä¸€å­˜åœ¨ç”Ÿå‘½çš„æ˜Ÿçƒã€‚å®ƒæ‹¥æœ‰æ¶²æ€æ°´ï¼ˆè¦†ç›–è¡¨é¢71%ï¼‰å’Œé€‚å®œçš„å¤§æ°”å±‚ï¼Œä¿æŠ¤æˆ‘ä»¬å…å—è¾å°„ä¼¤å®³ã€‚å®ƒæœ‰ä¸€é¢—å¤©ç„¶å«æ˜Ÿâ€”â€”æœˆçƒã€‚",
                year: "365 å¤©", temp: "15Â°C", type: 'earth'
            },
            {
                name: "ç«æ˜Ÿ", english: "Mars", feature: "çº¢è‰²æ˜Ÿçƒ",
                color: 0xff4500, size: 2.1, distance: 60, speed: 0.008,
                desc: "ç«æ˜Ÿè¡¨é¢è¦†ç›–ç€çº¢è‰²çš„æ°§åŒ–é“æ²™å°˜ï¼Œæ‰€ä»¥çœ‹èµ·æ¥æ˜¯çº¢è‰²çš„ã€‚å®ƒæœ‰å¤ªé˜³ç³»æœ€é«˜çš„ç«å±±ï¼ˆå¥¥æ—å¸•æ–¯å±±ï¼‰å’Œå·¨å¤§çš„å³¡è°·ã€‚ç§‘å­¦å®¶ä»¬æ­£åœ¨åŠªåŠ›æ¢ç´¢ç«æ˜Ÿï¼Œå¯»æ‰¾æ¶²æ€æ°´å’Œç”Ÿå‘½çš„ç—•è¿¹ã€‚",
                year: "687 å¤©", temp: "-65Â°C", type: 'rocky'
            },
            {
                name: "æœ¨æ˜Ÿ", english: "Jupiter", feature: "è¡Œæ˜Ÿä¹‹ç‹",
                color: 0xd9a066, size: 9, distance: 90, speed: 0.004,
                desc: "æœ¨æ˜Ÿæ˜¯å¤ªé˜³ç³»æœ€å¤§çš„è¡Œæ˜Ÿï¼Œä½“ç§¯èƒ½è£…ä¸‹1300ä¸ªåœ°çƒï¼å®ƒæ˜¯ä¸€é¢—æ°”æ€å·¨è¡Œæ˜Ÿï¼Œæ²¡æœ‰å›ºä½“è¡¨é¢ã€‚å®ƒæœ€è‘—åçš„æ˜¯â€œå¤§çº¢æ–‘â€ï¼Œé‚£æ˜¯ä¸€ä¸ªæŒç»­äº†å‡ ç™¾å¹´çš„å·¨å¤§åæ°”æ—‹é£æš´ã€‚",
                year: "12 å¹´", temp: "-110Â°C", type: 'gas'
            },
            {
                name: "åœŸæ˜Ÿ", english: "Saturn", feature: "æŒ‡ç¯ç‹",
                color: 0xe6dbb8, size: 7.5, distance: 120, speed: 0.003,
                desc: "åœŸæ˜Ÿè¢«èª‰ä¸ºå¤ªé˜³ç³»çš„â€œå®çŸ³â€ï¼Œå› ä¸ºå®ƒæ‹¥æœ‰æœ€å®½é˜”ã€æœ€ç¾ä¸½çš„è¡Œæ˜Ÿç¯ï¼Œç”±æ— æ•°å†°å—å’Œå²©çŸ³ç¢ç‰‡ç»„æˆã€‚å®ƒä¹Ÿæ˜¯ä¸€é¢—æ°”æ€å·¨è¡Œæ˜Ÿï¼Œå¯†åº¦å¾ˆå°ï¼Œå¦‚æœæœ‰ä¸€ä¸ªè¶³å¤Ÿå¤§çš„æµ´ç¼¸ï¼ŒåœŸæ˜Ÿèƒ½æ¼‚åœ¨æ°´é¢ä¸Šï¼",
                year: "29 å¹´", temp: "-140Â°C", type: 'gas', hasRing: true
            },
            {
                name: "å¤©ç‹æ˜Ÿ", english: "Uranus", feature: "å†°å·¨æ˜Ÿ",
                color: 0x66ccff, size: 5, distance: 150, speed: 0.002,
                desc: "å¤©ç‹æ˜Ÿæ˜¯ä¸€é¢—å†°å·¨æ˜Ÿï¼Œå¤§æ°”ä¸­å«æœ‰ç”²çƒ·ï¼Œæ‰€ä»¥å‘ˆç°æ¼‚äº®çš„é’è‰²ã€‚å®ƒæœ€ç‰¹åˆ«çš„åœ°æ–¹æ˜¯â€œèººç€â€è‡ªè½¬çš„ï¼Œè‡ªè½¬è½´å‡ ä¹æŒ‡å‘å¤ªé˜³ã€‚å®ƒéå¸¸å¯’å†·ï¼Œè¡¨é¢æ¸©åº¦ä½è‡³-224Â°Cã€‚",
                year: "84 å¹´", temp: "-195Â°C", type: 'ice'
            },
            {
                name: "æµ·ç‹æ˜Ÿ", english: "Neptune", feature: "é£æš´ä¹‹ç¥",
                color: 0x3333ff, size: 4.8, distance: 175, speed: 0.001,
                desc: "æµ·ç‹æ˜Ÿæ˜¯è·ç¦»å¤ªé˜³æœ€è¿œçš„è¡Œæ˜Ÿï¼Œä¹Ÿæ˜¯ä¸€é¢—æ·±è“è‰²çš„å†°å·¨æ˜Ÿã€‚å®ƒæ‹¥æœ‰å¤ªé˜³ç³»æœ€å¼ºçƒˆçš„é£æš´ï¼Œé£é€Ÿå¯è¾¾éŸ³é€Ÿçš„æ•°å€ã€‚å®ƒéå¸¸å¯’å†·ã€é»‘æš—ï¼Œæ˜¯ä¸ªç¥ç§˜çš„å†°å†»ä¸–ç•Œã€‚",
                year: "165 å¹´", temp: "-200Â°C", type: 'ice'
            }
        ];

        // --- åŠ¨æ€çº¹ç†ç”Ÿæˆå™¨ (è§£å†³ CORS é—®é¢˜) ---
        function generatePlanetTexture(data) {
            const size = 512;
            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');
            
            // å¡«å……åŸºç¡€è‰²
            ctx.fillStyle = '#' + data.color.toString(16).padStart(6, '0');
            ctx.fillRect(0, 0, size, size);

            // æ ¹æ®ç±»å‹æ·»åŠ ç»†èŠ‚
            if (data.type === 'star') {
                // å¤ªé˜³ï¼šéšæœºäº®æ–‘
                for(let i=0; i<50; i++) {
                    ctx.fillStyle = `rgba(255, 255, 0, ${Math.random()*0.3})`;
                    ctx.beginPath();
                    ctx.arc(Math.random()*size, Math.random()*size, Math.random()*50, 0, Math.PI*2);
                    ctx.fill();
                }
            } else if (data.type === 'gas') {
                // æ°”æ€è¡Œæ˜Ÿï¼šæ¨ªå‘æ¡çº¹
                for(let i=0; i<20; i++) {
                    ctx.fillStyle = `rgba(255, 255, 255, ${Math.random()*0.1})`;
                    ctx.fillRect(0, Math.random()*size, size, Math.random()*20+10);
                    ctx.fillStyle = `rgba(0, 0, 0, ${Math.random()*0.05})`;
                    ctx.fillRect(0, Math.random()*size, size, Math.random()*20+10);
                }
            } else if (data.type === 'rocky') {
                // å²©çŸ³è¡Œæ˜Ÿï¼šé™¨çŸ³å‘/æ–‘ç‚¹
                for(let i=0; i<40; i++) {
                    ctx.fillStyle = `rgba(0, 0, 0, ${Math.random()*0.1})`;
                    ctx.beginPath();
                    ctx.arc(Math.random()*size, Math.random()*size, Math.random()*30, 0, Math.PI*2);
                    ctx.fill();
                }
            } else if (data.type === 'earth') {
                // åœ°çƒï¼šç»¿è‰²é™†åœ°å—
                ctx.fillStyle = '#228B22'; // æ£®æ—ç»¿
                for(let i=0; i<15; i++) {
                    ctx.beginPath();
                    ctx.arc(Math.random()*size, Math.random()*size, Math.random()*80 + 20, 0, Math.PI*2);
                    ctx.fill();
                }
                // äº‘å±‚
                ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
                for(let i=0; i<20; i++) {
                    ctx.beginPath();
                    ctx.ellipse(Math.random()*size, Math.random()*size, Math.random()*100, Math.random()*30, 0, 0, Math.PI*2);
                    ctx.fill();
                }
            } else if (data.type === 'ice') {
                // å†°å·¨æ˜Ÿï¼šå¹³æ»‘ï¼Œç¨å¾®æœ‰ç‚¹äº‘
                ctx.fillStyle = `rgba(255, 255, 255, 0.1)`;
                ctx.fillRect(0, 0, size, size);
            }

            const texture = new THREE.CanvasTexture(canvas);
            return texture;
        }

        // --- å…¨å±€å˜é‡ ---
        let scene, camera, renderer, controls;
        let modalScene, modalCamera, modalRenderer, modalControls, modalPlanet;
        let animationId;
        const planetMeshes = []; 
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let hoveredObject = null;
        
        // çº¹ç†ç¼“å­˜
        const textureCache = {};

        function getTexture(data) {
            if (!textureCache[data.english]) {
                textureCache[data.english] = generatePlanetTexture(data);
            }
            return textureCache[data.english];
        }

        // --- ä¸»åœºæ™¯åˆå§‹åŒ– ---
        function initMainScene() {
            const container = document.getElementById('canvas-container');
            
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.002);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 100, 180);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            container.appendChild(renderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.maxDistance = 400;
            controls.minDistance = 20;

            const ambientLight = new THREE.AmbientLight(0x333333);
            scene.add(ambientLight);

            const sunLight = new THREE.PointLight(0xffffff, 1.5, 600);
            sunLight.position.set(0, 0, 0);
            sunLight.castShadow = true;
            scene.add(sunLight);

            createStarField();
            createSolarSystem();

            window.addEventListener('resize', onWindowResize);
            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('click', onMouseClick);
            
            animate();
        }

        function createStarField() {
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            for (let i = 0; i < 3000; i++) {
                vertices.push(
                    THREE.MathUtils.randFloatSpread(1000),
                    THREE.MathUtils.randFloatSpread(1000),
                    THREE.MathUtils.randFloatSpread(1000)
                );
            }
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            const material = new THREE.PointsMaterial({ color: 0xffffff, size: 0.7, transparent: true, opacity: 0.8 });
            const stars = new THREE.Points(geometry, material);
            scene.add(stars);
        }

        function createSolarSystem() {
            planetsData.forEach(data => {
                // 1. è½¨é“çº¿
                if (data.distance > 0) {
                    const orbitGeo = new THREE.RingGeometry(data.distance - 0.2, data.distance + 0.2, 128);
                    const orbitMat = new THREE.MeshBasicMaterial({ color: 0xffffff, opacity: 0.15, transparent: true, side: THREE.DoubleSide });
                    const orbit = new THREE.Mesh(orbitGeo, orbitMat);
                    orbit.rotation.x = Math.PI / 2;
                    scene.add(orbit);
                }

                // 2. æ˜Ÿçƒå®ä½“
                let geometry = new THREE.SphereGeometry(data.size, 64, 64);
                let material;
                const texture = getTexture(data);

                if (data.type === 'star') {
                    material = new THREE.MeshBasicMaterial({ map: texture });
                    // å¤ªé˜³å…‰æ™•
                    const glowGeo = new THREE.SphereGeometry(data.size * 1.3, 32, 32);
                    const glowMat = new THREE.MeshBasicMaterial({ color: 0xffaa00, transparent: true, opacity: 0.3 });
                    const glow = new THREE.Mesh(glowGeo, glowMat);
                    scene.add(glow);
                } else {
                    material = new THREE.MeshStandardMaterial({ 
                        map: texture,
                        roughness: 0.7,
                        metalness: 0.1
                    });
                }

                const planet = new THREE.Mesh(geometry, material);
                
                // éšæœºåˆå§‹è§’åº¦
                const angle = Math.random() * Math.PI * 2;
                planet.position.x = Math.cos(angle) * data.distance;
                planet.position.z = Math.sin(angle) * data.distance;
                
                planet.userData = { ...data, angle: angle };

                // åœŸæ˜Ÿç¯ç”Ÿæˆ
                if (data.hasRing) {
                    const ringGeo = new THREE.RingGeometry(data.size * 1.4, data.size * 2.2, 64);
                    const ringCanvas = document.createElement('canvas');
                    ringCanvas.width = 128; ringCanvas.height = 128;
                    const rbuf = ringCanvas.getContext('2d');
                    // ç”Ÿæˆç¯çº¹ç†
                    rbuf.fillStyle = 'rgba(200, 190, 150, 0.1)'; rbuf.fillRect(0,0,128,128);
                    for(let k=0; k<5; k++) {
                        rbuf.beginPath(); rbuf.arc(64,64, 30 + k*6, 0, Math.PI*2); 
                        rbuf.lineWidth=2; rbuf.strokeStyle = `rgba(200, 190, 150, ${0.3+Math.random()*0.4})`; rbuf.stroke();
                    }
                    const ringTex = new THREE.CanvasTexture(ringCanvas);
                    
                    const ringMat = new THREE.MeshStandardMaterial({ 
                        color: 0xada891, 
                        side: THREE.DoubleSide, 
                        transparent: true, 
                        opacity: 0.8,
                        map: ringTex
                    });
                    const ring = new THREE.Mesh(ringGeo, ringMat);
                    ring.rotation.x = Math.PI / 2; 
                    ring.rotation.y = Math.PI / 8;
                    planet.add(ring);
                }

                scene.add(planet);
                planetMeshes.push(planet);
            });
        }

        function animate() {
            animationId = requestAnimationFrame(animate);
            planetMeshes.forEach(mesh => {
                const data = mesh.userData;
                if (data.distance > 0) {
                    data.angle += data.speed * 0.1; // å…¬è½¬
                    mesh.position.x = Math.cos(data.angle) * data.distance;
                    mesh.position.z = Math.sin(data.angle) * data.distance;
                }
                mesh.rotation.y += 0.005; // è‡ªè½¬
            });
            controls.update();
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(planetMeshes);
            
            if (intersects.length > 0) {
                const object = intersects[0].object;
                if (hoveredObject !== object) {
                    if (hoveredObject) hoveredObject.scale.set(1, 1, 1);
                    hoveredObject = object;
                    document.body.style.cursor = 'pointer';
                    hoveredObject.scale.set(1.2, 1.2, 1.2);
                }
            } else {
                if (hoveredObject) {
                    hoveredObject.scale.set(1, 1, 1);
                    hoveredObject = null;
                    document.body.style.cursor = 'default';
                }
            }
        }

        function onMouseClick(event) {
            if (hoveredObject) openModal(hoveredObject.userData);
        }

        // --- å¼¹çª—é€»è¾‘ ---
        function openModal(data) {
            const modal = document.getElementById('planet-modal');
            // ä¿®æ”¹æ ‡é¢˜ï¼šä¸­æ–‡ + è‹±æ–‡
            document.getElementById('modal-title').textContent = `${data.name} (${data.english})`;
            document.getElementById('modal-title').style.color = '#' + data.color.toString(16).padStart(6,'0');
            // ä¿®æ”¹å‰¯æ ‡é¢˜ï¼šç§°å·
            document.getElementById('modal-subtitle').textContent = data.feature || data.english;
            document.getElementById('modal-desc').textContent = data.desc;
            document.getElementById('modal-year').textContent = data.year;
            document.getElementById('modal-temp').textContent = data.temp;

            modal.classList.remove('hidden');
            void modal.offsetWidth;
            modal.classList.remove('opacity-0', 'scale-95');
            modal.classList.add('opacity-100', 'scale-100');
            initModal3D(data);
        }

        function closeModal() {
            const modal = document.getElementById('planet-modal');
            modal.classList.remove('opacity-100', 'scale-100');
            modal.classList.add('opacity-0', 'scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
                disposeModal3D();
            }, 300);
        }

        function initModal3D(data) {
            const container = document.getElementById('modal-3d-container');
            container.innerHTML = '<div class="absolute bottom-2 right-2 text-xs text-white/30 pointer-events-none">æ‹–æ‹½æ—‹è½¬</div>';
            const w = container.clientWidth;
            const h = container.clientHeight;

            modalScene = new THREE.Scene();
            modalCamera = new THREE.PerspectiveCamera(45, w / h, 0.1, 100);
            modalCamera.position.z = 8;
            modalRenderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            modalRenderer.setSize(w, h);
            container.appendChild(modalRenderer.domElement);
            modalControls = new THREE.OrbitControls(modalCamera, modalRenderer.domElement);
            modalControls.enableZoom = true;
            modalControls.autoRotate = true;

            const ambient = new THREE.AmbientLight(0xffffff, 0.4);
            modalScene.add(ambient);
            const dirLight = new THREE.DirectionalLight(0xffffff, 1.0);
            dirLight.position.set(5, 3, 5);
            modalScene.add(dirLight);

            const geo = new THREE.SphereGeometry(2.5, 64, 64);
            const texture = getTexture(data);
            
            let mat;
            if (data.type === 'star') {
                mat = new THREE.MeshBasicMaterial({ map: texture });
            } else {
                mat = new THREE.MeshStandardMaterial({ 
                    map: texture,
                    roughness: 0.6 
                });
            }

            modalPlanet = new THREE.Mesh(geo, mat);
            if(data.hasRing) {
                 const ringGeo = new THREE.RingGeometry(3.0, 4.5, 64);
                 // å¤ç”¨ç”Ÿæˆé€»è¾‘ï¼Œç®€å•ç”»ä¸ªç¯æè´¨
                 const ringCanvas = document.createElement('canvas'); ringCanvas.width=64; ringCanvas.height=64;
                 const rc = ringCanvas.getContext('2d');
                 rc.fillStyle='rgba(255,255,255,0.4)'; rc.fillRect(0,0,64,64);
                 const ringTex = new THREE.CanvasTexture(ringCanvas);
                 
                 const ringMat = new THREE.MeshStandardMaterial({ 
                    color: 0xada891, side: THREE.DoubleSide, transparent: true, opacity: 0.8, map: ringTex
                 });
                 const ring = new THREE.Mesh(ringGeo, ringMat);
                 ring.rotation.x = Math.PI / 3;
                 modalPlanet.add(ring);
            }

            modalScene.add(modalPlanet);

            function modalAnimate() {
                if (!modalRenderer) return;
                requestAnimationFrame(modalAnimate);
                modalControls.update();
                modalRenderer.render(modalScene, modalCamera);
            }
            modalAnimate();
        }

        function disposeModal3D() {
            if (modalRenderer) {
                modalRenderer.dispose();
                modalRenderer.forceContextLoss();
                const container = document.getElementById('modal-3d-container');
                container.innerHTML = '';
                modalRenderer = null;
            }
        }

        initMainScene();
    </script>
</body>
</html>
